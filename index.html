<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brave Frontier RPG</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Orbitron:wght@400;500;700;900&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #6644cc;
            --secondary: #4488ff;
            --accent: #ffcc00;
            --danger: #ff4466;
            --success: #00cc66;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #08080f;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Orbitron', sans-serif;
            overflow: hidden;
        }

        #game {
            width: 100%;
            max-width: 500px;
            height: 100vh;
            max-height: 850px;
            position: relative;
            overflow: hidden;
            background: #0a0a15;
        }

        /* ============ BATTLE SCENE ============ */
        #battle-scene {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 200px;
            overflow: hidden;
        }

        /* Animated Background */
        #bg {
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg,
                    #0d0520 0%,
                    #1a0a35 25%,
                    #251045 50%,
                    #1a0a35 75%,
                    #0d0520 100%);
        }

        /* Animated nebula clouds */
        .nebula {
            position: absolute;
            border-radius: 50%;
            filter: blur(40px);
            opacity: 0.6;
            animation: nebulaDrift 20s ease-in-out infinite;
        }

        .nebula:nth-child(1) {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(100, 50, 200, 0.5) 0%, transparent 70%);
            top: -50px;
            left: -100px;
            animation-delay: 0s;
        }

        .nebula:nth-child(2) {
            width: 250px;
            height: 250px;
            background: radial-gradient(circle, rgba(50, 100, 200, 0.4) 0%, transparent 70%);
            top: 100px;
            right: -80px;
            animation-delay: -5s;
        }

        .nebula:nth-child(3) {
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(200, 50, 150, 0.3) 0%, transparent 70%);
            bottom: 100px;
            left: 50%;
            animation-delay: -10s;
        }

        @keyframes nebulaDrift {

            0%,
            100% {
                transform: translate(0, 0) scale(1);
            }

            25% {
                transform: translate(30px, 20px) scale(1.1);
            }

            50% {
                transform: translate(-20px, 40px) scale(0.95);
            }

            75% {
                transform: translate(20px, -30px) scale(1.05);
            }
        }

        /* Floating particles */
        .star-particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: rgba(200, 180, 255, 0.8);
            border-radius: 50%;
            box-shadow: 0 0 6px rgba(200, 180, 255, 0.8);
        }

        /* Ground plane */
        #ground-plane {
            position: absolute;
            bottom: 0;
            left: -50%;
            width: 200%;
            height: 200px;
            background: linear-gradient(180deg,
                    rgba(40, 20, 80, 0.3) 0%,
                    rgba(20, 10, 50, 0.6) 50%,
                    rgba(10, 5, 30, 0.9) 100%);
            transform: perspective(500px) rotateX(60deg);
            transform-origin: center top;
        }

        #ground-plane::before {
            content: '';
            position: absolute;
            inset: 0;
            background:
                repeating-linear-gradient(90deg,
                    transparent 0px,
                    transparent 60px,
                    rgba(100, 70, 180, 0.15) 60px,
                    rgba(100, 70, 180, 0.15) 62px),
                repeating-linear-gradient(0deg,
                    transparent 0px,
                    transparent 30px,
                    rgba(100, 70, 180, 0.1) 30px,
                    rgba(100, 70, 180, 0.1) 32px);
            animation: gridScroll 4s linear infinite;
        }

        @keyframes gridScroll {
            from {
                background-position: 0 0, 0 0;
            }

            to {
                background-position: 62px 0, 0 32px;
            }
        }

        /* ============ ENEMY ============ */
        #enemy-container {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }

        #enemy-info {
            margin-bottom: 10px;
        }

        #enemy-name {
            color: var(--danger);
            font-size: 16px;
            font-weight: 700;
            text-shadow: 0 0 15px rgba(255, 68, 102, 0.8);
            letter-spacing: 3px;
            margin-bottom: 8px;
        }

        .hp-bar-outer {
            width: 280px;
            height: 24px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid var(--danger);
            border-radius: 12px;
            padding: 3px;
            box-shadow: 0 0 15px rgba(255, 68, 102, 0.4);
        }

        .hp-bar-inner {
            height: 100%;
            background: linear-gradient(90deg, #cc2244 0%, #ff4466 50%, #ff6688 75%, #ff4466 100%);
            background-size: 200% 100%;
            border-radius: 8px;
            transition: width 0.4s ease;
            position: relative;
            animation: hpShine 2s linear infinite;
        }

        @keyframes hpShine {
            from {
                background-position: 200% 0;
            }

            to {
                background-position: 0% 0;
            }
        }

        .hp-bar-inner::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.4) 0%, transparent 100%);
            border-radius: 8px 8px 0 0;
        }

        .hp-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 11px;
            font-weight: 700;
            text-shadow: 0 0 5px #000;
            white-space: nowrap;
        }

        #enemy-sprite {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            position: relative;
        }

        #enemy-sprite img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 0 30px rgba(255, 100, 50, 0.7));
            animation: enemyFloat 3s ease-in-out infinite;
        }

        @keyframes enemyFloat {

            0%,
            100% {
                transform: translateY(0) scale(1);
            }

            30% {
                transform: translateY(-12px) scale(1.03) rotate(-1deg);
            }

            60% {
                transform: translateY(-8px) scale(1.02) rotate(1deg);
            }
        }

        #enemy-sprite::before {
            content: '';
            position: absolute;
            inset: -30px;
            background: radial-gradient(circle, rgba(255, 100, 0, 0.25) 0%, transparent 70%);
            animation: auraFlicker 2s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes auraFlicker {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.6;
            }

            50% {
                transform: scale(1.2);
                opacity: 1;
            }
        }

        .enemy-hit {
            animation: enemyHit 0.4s ease-out !important;
        }

        @keyframes enemyHit {
            0% {
                transform: translateX(0);
                filter: brightness(1);
            }

            15% {
                transform: translateX(-20px);
                filter: brightness(3);
            }

            30% {
                transform: translateX(20px);
                filter: brightness(2);
            }

            45% {
                transform: translateX(-15px);
                filter: brightness(2.5);
            }

            60% {
                transform: translateX(15px);
                filter: brightness(1.5);
            }

            75% {
                transform: translateX(-5px);
                filter: brightness(1.2);
            }

            100% {
                transform: translateX(0);
                filter: brightness(1);
            }
        }

        /* ============ HERO ============ */
        #hero-container {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }

        #hero-sprite {
            width: 180px;
            height: 180px;
            margin: 0 auto 15px;
            position: relative;
        }

        #hero-sprite img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 0 25px rgba(0, 150, 255, 0.8));
            animation: heroIdle 2.5s ease-in-out infinite;
        }

        @keyframes heroIdle {

            0%,
            100% {
                transform: translateY(0) scale(1) rotate(0deg);
            }

            20% {
                transform: translateY(-5px) scale(1.01) rotate(0.5deg);
            }

            40% {
                transform: translateY(-10px) scale(1.02);
            }

            60% {
                transform: translateY(-8px) scale(1.015) rotate(-0.5deg);
            }

            80% {
                transform: translateY(-3px) scale(1.005);
            }
        }

        /* Hero aura layers */
        #hero-sprite::before {
            content: '';
            position: absolute;
            inset: -40px;
            background: radial-gradient(circle, rgba(0, 150, 255, 0.3) 0%, transparent 70%);
            animation: heroAura 2s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes heroAura {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.5;
            }

            50% {
                transform: scale(1.15);
                opacity: 0.9;
            }
        }

        /* Energy ring effect */
        .hero-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 120px;
            height: 120px;
            border: 2px solid rgba(0, 200, 255, 0.6);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: ringExpand 3s ease-out infinite;
            pointer-events: none;
        }

        .hero-ring:nth-child(2) {
            animation-delay: 1s;
        }

        .hero-ring:nth-child(3) {
            animation-delay: 2s;
        }

        @keyframes ringExpand {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 1;
            }

            100% {
                transform: translate(-50%, -50%) scale(2);
                opacity: 0;
            }
        }

        /* Hero attack animation */
        .hero-attacking img {
            animation: heroAttack 0.5s ease-out !important;
        }

        @keyframes heroAttack {
            0% {
                transform: translateY(0) translateX(0) scale(1);
            }

            15% {
                transform: translateY(10px) translateX(-20px) scale(1.1);
            }

            40% {
                transform: translateY(-180px) translateX(100px) scale(1.25) rotate(10deg);
                filter: brightness(1.5);
            }

            60% {
                transform: translateY(-180px) translateX(100px) scale(1.2);
            }

            100% {
                transform: translateY(0) translateX(0) scale(1);
            }
        }

        #hero-info {
            margin-top: 10px;
        }

        #hero-name {
            color: var(--secondary);
            font-size: 14px;
            font-weight: 700;
            text-shadow: 0 0 15px rgba(68, 136, 255, 0.8);
            letter-spacing: 2px;
            margin-bottom: 6px;
        }

        .hero-hp-bar {
            width: 200px;
            height: 18px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid var(--success);
            border-radius: 9px;
            padding: 2px;
            margin: 0 auto 6px;
            box-shadow: 0 0 10px rgba(0, 204, 102, 0.4);
        }

        .hero-hp-fill {
            height: 100%;
            background: linear-gradient(90deg, #00aa44, #00cc66, #00ff88, #00cc66);
            background-size: 200% 100%;
            border-radius: 6px;
            animation: hpShine 2s linear infinite;
            position: relative;
        }

        .hero-hp-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.4), transparent);
            border-radius: 6px 6px 0 0;
        }

        /* BB Gauge */
        .bb-gauge {
            width: 200px;
            height: 22px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid var(--accent);
            border-radius: 11px;
            padding: 2px;
            margin: 0 auto;
            position: relative;
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.4);
        }

        .bb-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #cc6600, #ff9900, #ffcc00, #ffee66, #ffcc00);
            background-size: 300% 100%;
            border-radius: 8px;
            transition: width 0.4s ease;
            animation: bbShine 1.5s linear infinite;
        }

        @keyframes bbShine {
            from {
                background-position: 300% 0;
            }

            to {
                background-position: 0% 0;
            }
        }

        .bb-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--accent);
            font-size: 10px;
            font-weight: 700;
            text-shadow: 0 0 5px #000;
            letter-spacing: 2px;
        }

        .bb-ready {
            animation: bbPulse 0.5s ease-in-out infinite;
        }

        @keyframes bbPulse {

            0%,
            100% {
                box-shadow: 0 0 15px rgba(255, 204, 0, 0.4);
            }

            50% {
                box-shadow: 0 0 30px rgba(255, 204, 0, 0.9), 0 0 50px rgba(255, 200, 100, 0.5);
            }
        }

        /* ============ EFFECTS LAYER ============ */
        #effects-layer {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 100;
        }

        #screen-flash {
            position: absolute;
            inset: 0;
            background: #fff;
            opacity: 0;
            transition: opacity 0.1s;
        }

        .damage-number {
            position: absolute;
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            color: var(--danger);
            text-shadow:
                0 0 10px #ff0000,
                2px 2px 0 #000,
                -2px -2px 0 #000,
                2px -2px 0 #000,
                -2px 2px 0 #000;
            animation: dmgFloat 1s ease-out forwards;
            z-index: 150;
        }

        .damage-number.crit {
            color: #ffff00;
            text-shadow:
                0 0 20px #ff6600,
                0 0 40px #ff3300,
                2px 2px 0 #000,
                -2px -2px 0 #000;
        }

        @keyframes dmgFloat {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 1;
            }

            20% {
                transform: translateY(-40px) scale(1.4);
            }

            100% {
                transform: translateY(-120px) scale(0.8);
                opacity: 0;
            }
        }

        .hit-particle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
        }

        /* Slash effect */
        .slash-effect {
            position: absolute;
            width: 150px;
            height: 150px;
            background: linear-gradient(45deg,
                    transparent 30%,
                    rgba(255, 255, 255, 0.9) 45%,
                    rgba(200, 220, 255, 0.9) 50%,
                    rgba(255, 255, 255, 0.9) 55%,
                    transparent 70%);
            opacity: 0;
            pointer-events: none;
        }

        .slash-effect.active {
            animation: slashCut 0.25s ease-out;
        }

        @keyframes slashCut {
            0% {
                transform: scale(0.3) rotate(-60deg);
                opacity: 1;
            }

            100% {
                transform: scale(2) rotate(30deg);
                opacity: 0;
            }
        }

        /* Screen shake */
        .screen-shake {
            animation: shake 0.4s ease-out;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            10% {
                transform: translateX(-8px) rotate(-0.5deg);
            }

            20% {
                transform: translateX(8px) rotate(0.5deg);
            }

            30% {
                transform: translateX(-6px);
            }

            40% {
                transform: translateX(6px);
            }

            50% {
                transform: translateX(-4px);
            }

            60% {
                transform: translateX(4px);
            }
        }

        /* ============ UI PANEL ============ */
        #ui-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 200px;
            background: linear-gradient(180deg,
                    rgba(15, 10, 30, 0.95) 0%,
                    rgba(10, 5, 20, 0.98) 100%);
            border-top: 3px solid rgba(100, 68, 204, 0.7);
            display: flex;
            flex-direction: column;
            padding: 15px 20px;
        }

        #ui-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(150, 100, 255, 0.8), transparent);
        }

        /* Combo display */
        #combo-section {
            text-align: center;
            margin-bottom: 15px;
        }

        #combo-count {
            font-size: 42px;
            font-weight: 900;
            color: var(--accent);
            text-shadow: 0 0 20px #ff6600, 0 0 40px rgba(255, 100, 0, 0.5);
            line-height: 1;
            transition: transform 0.15s ease;
        }

        #combo-count.pop {
            transform: scale(1.3);
        }

        #combo-label {
            font-size: 12px;
            color: rgba(255, 200, 100, 0.8);
            letter-spacing: 4px;
            margin-top: 2px;
        }

        /* Action buttons */
        #action-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            flex: 1;
            max-width: 140px;
            padding: 14px 10px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            font-size: 12px;
            font-weight: 700;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .action-btn .icon {
            font-size: 22px;
        }

        .action-btn.attack {
            background: linear-gradient(180deg, #5544aa 0%, #3322aa 100%);
            border: 2px solid rgba(150, 120, 255, 0.6);
            box-shadow: 0 4px 15px rgba(85, 68, 170, 0.5);
        }

        .action-btn.skill {
            background: linear-gradient(180deg, #4477aa 0%, #225588 100%);
            border: 2px solid rgba(100, 180, 255, 0.6);
            box-shadow: 0 4px 15px rgba(68, 119, 170, 0.5);
        }

        .action-btn.burst {
            background: linear-gradient(180deg, #aa6622 0%, #884411 100%);
            border: 2px solid rgba(255, 180, 100, 0.6);
            box-shadow: 0 4px 15px rgba(170, 102, 34, 0.5);
        }

        .action-btn:hover {
            transform: translateY(-4px);
            filter: brightness(1.2);
        }

        .action-btn:active {
            transform: translateY(-1px);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .action-btn.burst.ready {
            animation: burstReady 0.8s ease-in-out infinite;
        }

        @keyframes burstReady {

            0%,
            100% {
                box-shadow: 0 4px 15px rgba(170, 102, 34, 0.5);
                border-color: rgba(255, 180, 100, 0.6);
            }

            50% {
                box-shadow: 0 6px 30px rgba(255, 150, 50, 0.9), 0 0 50px rgba(255, 200, 100, 0.4);
                border-color: rgba(255, 230, 150, 1);
            }
        }

        /* Wave info */
        #wave-info {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-size: 14px;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(100, 50, 200, 0.8);
            letter-spacing: 3px;
        }

        /* Victory/Defeat overlay */
        #result-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 500;
        }

        #result-overlay.show {
            display: flex;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        #result-title {
            font-family: 'Cinzel', serif;
            font-size: 48px;
            font-weight: 900;
            margin-bottom: 30px;
            animation: resultPulse 1s ease-in-out infinite;
        }

        @keyframes resultPulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        #result-title.victory {
            color: var(--accent);
            text-shadow: 0 0 30px #ff6600, 0 0 60px rgba(255, 100, 0, 0.5);
        }

        #result-title.defeat {
            color: var(--danger);
            text-shadow: 0 0 30px #ff0000, 0 0 60px rgba(255, 0, 0, 0.5);
        }

        #result-rewards {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .reward-box {
            background: linear-gradient(180deg, rgba(60, 40, 100, 0.8), rgba(30, 20, 60, 0.9));
            padding: 15px 25px;
            border-radius: 10px;
            border: 2px solid rgba(150, 100, 255, 0.5);
            color: var(--accent);
            font-size: 18px;
            font-weight: 700;
        }

        #continue-btn {
            padding: 15px 50px;
            font-family: 'Cinzel', serif;
            font-size: 18px;
            font-weight: 700;
            color: #fff;
            background: linear-gradient(180deg, #5544aa, #3322aa);
            border: 2px solid rgba(150, 120, 255, 0.7);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            letter-spacing: 2px;
        }

        #continue-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(100, 50, 200, 0.6);
        }
    </style>
</head>

<body>
    <div id="game">
        <!-- Battle Scene -->
        <div id="battle-scene">
            <div id="bg">
                <div class="nebula"></div>
                <div class="nebula"></div>
                <div class="nebula"></div>
            </div>
            <div id="ground-plane"></div>

            <!-- Wave Info -->
            <div id="wave-info">WAVE 1 / 3</div>

            <!-- Enemy -->
            <div id="enemy-container">
                <div id="enemy-info">
                    <div id="enemy-name">SHADOW DRAGON</div>
                    <div class="hp-bar-outer">
                        <div class="hp-bar-inner" id="enemy-hp-bar" style="width: 100%"></div>
                        <div class="hp-text" id="enemy-hp-text">50000 / 50000</div>
                    </div>
                </div>
                <div id="enemy-sprite">
                    <img src="enemy.png" alt="Shadow Dragon" id="enemy-img">
                </div>
            </div>

            <!-- Hero -->
            <div id="hero-container">
                <div id="hero-sprite">
                    <div class="hero-ring"></div>
                    <div class="hero-ring"></div>
                    <div class="hero-ring"></div>
                    <img src="hero.png" alt="Azure Knight" id="hero-img">
                </div>
                <div id="hero-info">
                    <div id="hero-name">AZURE KNIGHT</div>
                    <div class="hero-hp-bar">
                        <div class="hero-hp-fill" id="hero-hp-bar" style="width: 100%"></div>
                    </div>
                    <div class="bb-gauge" id="bb-gauge">
                        <div class="bb-fill" id="bb-fill"></div>
                        <div class="bb-label">BRAVE BURST</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Effects Layer -->
        <div id="effects-layer">
            <div id="screen-flash"></div>
            <div class="slash-effect" id="slash-effect"></div>
        </div>

        <!-- UI Panel -->
        <div id="ui-panel">
            <div id="combo-section">
                <div id="combo-count">0</div>
                <div id="combo-label">COMBO</div>
            </div>
            <div id="action-buttons">
                <button class="action-btn attack" id="btn-attack" onclick="doAttack()">
                    <span class="icon">‚öîÔ∏è</span>
                    <span>Attack</span>
                </button>
                <button class="action-btn skill" id="btn-skill" onclick="doSkill()">
                    <span class="icon">‚ú®</span>
                    <span>Skill</span>
                </button>
                <button class="action-btn burst" id="btn-burst" onclick="doBurst()">
                    <span class="icon">üí•</span>
                    <span>Burst</span>
                </button>
            </div>
        </div>

        <!-- Result Overlay -->
        <div id="result-overlay">
            <div id="result-title">VICTORY!</div>
            <div id="result-rewards">
                <div class="reward-box">üíé x100</div>
                <div class="reward-box">‚≠ê x500 EXP</div>
            </div>
            <button id="continue-btn" onclick="resetBattle()">CONTINUE</button>
        </div>
    </div>

    <script>
        // ============ GAME STATE ============
        const state = {
            heroHP: 5000,
            heroMaxHP: 5000,
            enemyHP: 50000,
            enemyMaxHP: 50000,
            bb: 0,
            maxBB: 100,
            combo: 0,
            animating: false,
            wave: 1,
            maxWave: 3
        };

        // ============ DOM ELEMENTS ============
        const battleScene = document.getElementById('battle-scene');
        const heroSprite = document.getElementById('hero-sprite');
        const enemySprite = document.getElementById('enemy-sprite');
        const enemyImg = document.getElementById('enemy-img');
        const screenFlash = document.getElementById('screen-flash');
        const slashEffect = document.getElementById('slash-effect');
        const effectsLayer = document.getElementById('effects-layer');
        const comboCount = document.getElementById('combo-count');
        const bbGauge = document.getElementById('bb-gauge');
        const bbFill = document.getElementById('bb-fill');
        const btnBurst = document.getElementById('btn-burst');

        // Create star particles
        function createStars() {
            const bg = document.getElementById('bg');
            for (let i = 0; i < 40; i++) {
                const star = document.createElement('div');
                star.className = 'star-particle';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 5 + 's';
                star.style.animation = `starTwinkle ${3 + Math.random() * 4}s ease-in-out infinite`;
                bg.appendChild(star);
            }
        }

        // Add twinkle animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes starTwinkle {
                0%, 100% { opacity: 0.3; transform: scale(1); }
                50% { opacity: 1; transform: scale(1.5); }
            }
        `;
        document.head.appendChild(style);
        createStars();

        // ============ ACTIONS ============
        async function doAttack() {
            if (state.animating) return;
            await performAction('attack', 2000, 1);
        }

        async function doSkill() {
            if (state.animating) return;
            await performAction('skill', 4500, 3);
        }

        async function doBurst() {
            if (state.animating || state.bb < state.maxBB) return;
            state.bb = 0;
            updateUI();
            await performAction('burst', 15000, 7);
        }

        async function performAction(type, baseDmg, hits) {
            state.animating = true;
            disableButtons(true);

            // Hero attack animation
            heroSprite.classList.add('hero-attacking');

            await sleep(250);

            // Multi-hit damage
            for (let i = 0; i < hits; i++) {
                const dmg = Math.floor(baseDmg / hits + Math.random() * 500);
                const crit = Math.random() > 0.7;
                const finalDmg = crit ? Math.floor(dmg * 1.5) : dmg;

                // Visual effects
                flashScreen(type === 'burst' ? 0.7 : type === 'skill' ? 0.5 : 0.3);
                shakeScreen();
                showSlash();
                createHitParticles(type);

                // Enemy hit animation
                enemyImg.classList.add('enemy-hit');
                setTimeout(() => enemyImg.classList.remove('enemy-hit'), 400);

                // Show damage number
                showDamage(finalDmg, crit);

                // Apply damage
                state.enemyHP = Math.max(0, state.enemyHP - finalDmg);
                state.combo++;

                // Add BB
                if (type !== 'burst') {
                    state.bb = Math.min(state.maxBB, state.bb + 12);
                }

                updateUI();
                await sleep(140);
            }

            heroSprite.classList.remove('hero-attacking');

            // Check enemy defeated
            if (state.enemyHP <= 0) {
                await sleep(600);
                showResult(true);
                state.animating = false;
                return;
            }

            // Enemy counter attack
            await sleep(500);
            await enemyAttack();

            disableButtons(false);
            state.animating = false;
        }

        async function enemyAttack() {
            // Simple counter - enemy damages hero
            flashScreen(0.3);
            shakeScreen();

            state.heroHP = Math.max(0, state.heroHP - 150);
            state.combo = 0;
            updateUI();

            if (state.heroHP <= 0) {
                await sleep(500);
                showResult(false);
            }
        }

        // ============ VISUAL EFFECTS ============
        function flashScreen(intensity) {
            screenFlash.style.opacity = intensity;
            setTimeout(() => screenFlash.style.opacity = 0, 80);
        }

        function shakeScreen() {
            battleScene.classList.add('screen-shake');
            setTimeout(() => battleScene.classList.remove('screen-shake'), 400);
        }

        function showSlash() {
            const rect = enemySprite.getBoundingClientRect();
            const gameRect = document.getElementById('game').getBoundingClientRect();

            slashEffect.style.left = (rect.left - gameRect.left + rect.width / 2 - 75) + 'px';
            slashEffect.style.top = (rect.top - gameRect.top + rect.height / 2 - 75) + 'px';
            slashEffect.classList.remove('active');
            void slashEffect.offsetWidth;
            slashEffect.classList.add('active');
        }

        function createHitParticles(type) {
            const colors = type === 'burst' ? ['#ffcc00', '#ff6600', '#ff3300', '#ffffff'] :
                type === 'skill' ? ['#00ddff', '#0088ff', '#ffffff', '#aaccff'] :
                    ['#ffffff', '#aaccff', '#88aaff', '#ccddff'];

            const count = type === 'burst' ? 25 : type === 'skill' ? 18 : 10;
            const rect = enemySprite.getBoundingClientRect();
            const gameRect = document.getElementById('game').getBoundingClientRect();
            const cx = rect.left - gameRect.left + rect.width / 2;
            const cy = rect.top - gameRect.top + rect.height / 2;

            for (let i = 0; i < count; i++) {
                const p = document.createElement('div');
                p.className = 'hit-particle';
                const color = colors[Math.floor(Math.random() * colors.length)];
                const size = type === 'burst' ? 8 + Math.random() * 10 : 4 + Math.random() * 8;
                const angle = Math.random() * Math.PI * 2;
                const dist = 80 + Math.random() * 120;
                const dur = 0.3 + Math.random() * 0.3;

                p.style.cssText = `
                    left: ${cx}px;
                    top: ${cy}px;
                    width: ${size}px;
                    height: ${size}px;
                    background: ${color};
                    box-shadow: 0 0 ${size * 2}px ${color};
                    transition: all ${dur}s ease-out;
                `;
                effectsLayer.appendChild(p);

                requestAnimationFrame(() => {
                    p.style.transform = `translate(${Math.cos(angle) * dist}px, ${Math.sin(angle) * dist}px) scale(0)`;
                    p.style.opacity = 0;
                });

                setTimeout(() => p.remove(), dur * 1000);
            }
        }

        function showDamage(amount, crit) {
            const num = document.createElement('div');
            num.className = 'damage-number' + (crit ? ' crit' : '');
            num.style.fontSize = crit ? '38px' : '28px';
            num.textContent = amount.toLocaleString();

            const rect = enemySprite.getBoundingClientRect();
            const gameRect = document.getElementById('game').getBoundingClientRect();

            num.style.left = (rect.left - gameRect.left + rect.width / 2 - 50 + (Math.random() - 0.5) * 80) + 'px';
            num.style.top = (rect.top - gameRect.top + 30) + 'px';

            effectsLayer.appendChild(num);
            setTimeout(() => num.remove(), 1000);
        }

        // ============ UI UPDATE ============
        function updateUI() {
            // HP bars
            document.getElementById('hero-hp-bar').style.width = (state.heroHP / state.heroMaxHP * 100) + '%';
            document.getElementById('enemy-hp-bar').style.width = (state.enemyHP / state.enemyMaxHP * 100) + '%';
            document.getElementById('enemy-hp-text').textContent =
                `${state.enemyHP.toLocaleString()} / ${state.enemyMaxHP.toLocaleString()}`;

            // BB gauge
            bbFill.style.width = (state.bb / state.maxBB * 100) + '%';

            if (state.bb >= state.maxBB) {
                bbGauge.classList.add('bb-ready');
                btnBurst.classList.add('ready');
            } else {
                bbGauge.classList.remove('bb-ready');
                btnBurst.classList.remove('ready');
            }

            // Combo with pop effect
            comboCount.textContent = state.combo;
            comboCount.classList.add('pop');
            setTimeout(() => comboCount.classList.remove('pop'), 150);
        }

        function disableButtons(disabled) {
            document.querySelectorAll('.action-btn').forEach(btn => btn.disabled = disabled);
        }

        // ============ RESULT ============
        function showResult(victory) {
            const overlay = document.getElementById('result-overlay');
            const title = document.getElementById('result-title');

            title.textContent = victory ? 'VICTORY!' : 'DEFEAT';
            title.className = victory ? 'victory' : 'defeat';
            overlay.classList.add('show');
        }

        function resetBattle() {
            state.heroHP = state.heroMaxHP;
            state.enemyHP = state.enemyMaxHP;
            state.bb = 0;
            state.combo = 0;
            state.animating = false;

            updateUI();
            disableButtons(false);
            document.getElementById('result-overlay').classList.remove('show');
        }

        // ============ UTILITY ============
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', e => {
            if (e.key === 'a' || e.key === 'A') doAttack();
            if (e.key === 's' || e.key === 'S') doSkill();
            if (e.key === 'd' || e.key === 'D') doBurst();
        });

        // Initial UI
        updateUI();
    </script>
</body>

</html>